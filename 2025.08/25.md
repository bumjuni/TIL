# 아두이노

모두의 아두이노(다카모트 다카요리/장진희) p.68 ~ 124

---

### 시리얼 통신

- 아두이노와 컴퓨터 연결 시 스케치 업로드, 시리얼 모니터를 통해 아두이노의 동작 모니터링 가능

**시리얼 통신 시작하기**

- `void Serial.begin(buad, config)`
    - buad rate: 1초 동안 수행하는 변조 횟수. 시리얼 모니터 우측 하단에 표시된 설정 속도와 일치해야 함
    - `buad`: `long` (300, 1200, 2400, 4800, 9600, 14400, 19200, 28800, 38400, 57600, 115200 中 1)
    - `config`: data, parity, stop bits등을 설정할 수 있음
        
        참고) https://docs.arduino.cc/language-reference/en/functions/communication/serial/begin
        

**시리얼 모니터에 내용 출력**

- `size_t Serial.print(val, format)`
    - 시리얼 모니터에 줄바꿈 없이 내용 출력
    - `format`: `BIN`, `OCT`, `HEX` , `DEC` 등의 포맷
- `size_t Serial.println(val, format)`
    - 시리얼 모니터에 `val`에 줄바꿈을 더해 내용 출력
- `size_t Serial.write(val)`
    
    `Serial.write(str)`
    
    `Serial.write(buf, len)`
    
    - 시리얼 모니터에 줄바꿈 없이 내용 출력
    - `val` : 1byte
    - `str`: 1byte이상의 문자열
    - `buf`: 배열, `len`: 배열의 길이

### 부품 사용

- 전류는 접지(GND)를 향해 흘러감
- 중간에 극성 부품이 있을 경우 양극으로 전류가 들어가서 음극으로 흐름
    
    ⇒ 극성 부품은 전원과 GND를 고려하여 연결
    
- 빵판
    - 위, 아래 두줄은 가로(긴쪽)로 연결, 가운데는 세로(짧은쪽)로 연결
    - IC칩과 같이 양쪽의 핀이 연결되면 안 되는 경우 가운데 부분에 연결

## 통신

### 아날로그 입출력

- 아날로그 입력
    - 포트: A0~A5
    - 입력값: 0~5V
    - `analogRead()`  반환값: 0~1023
- 아날로그 출력
    - 포트: 보드 위에 `~`표시가 붙은 포트(D3, D5, D6, D9, D10, D11)
    - 출력값: 0~5V
    - `analogWrite()` 매개변수: 0~255

### 디지털 입출력

- 포트: D0~D13 + D15~D19
- 입출력 값: LOW = 0 = 0V, HIGH = 1 = 3.3V or 5V

### 시리얼 통신

|  | UART | I2C 버스 | SPI 버스 |
| --- | --- | --- | --- |
| 비동기/동기 | 비동기식 | 동기식 | 동기식 |
| 연속 연결 | 불가능 | 여러 슬레이브 접속 가능 | 여러 슬레이브 접속 가능 |
| 버스 |  | SCL(시리얼 클록) <br /> SDA(시리얼 데이터) | SCK(시리얼 클록) <br /> 단방향 SDI, SDO |
| 이용 대상 | 간단한 통신 | 양방향 SDA 통신 | 고속 통신 처리 |
| 아두이노 우노 포트 | D0, D1 | A4(SDA), A5(SCL) | D10(SS), D11(MOSI), D12(MISO), D13(SCK) |
| 라이브러리 | SoftwareSerial | Wire | SPI |

## 아두이노 프로그래밍 기초

**구조**

- CPU + 메모리 + 입출력
- 메모리 = RAM(변수 저장; 휘발성) + ROM(프로그램 저장; 비휘발성) + 부트 로더(펌웨어)

**컴파일**

- IDE에서 스케치 작성 + 헤더파일 포함하여 컴파일 → 실행 파일로 변환한 뒤 아두이노로 업로드
    
    (아두이노에서 컴파일이 이루어지는게 아님)
    

**문법**

- 숫자값 정의
    
    16진수 → 앞에 `0x`, `0X` (`0X13`)
    
    8진수 → 앞에 `0` (`0172`)
    
    2진수 → 앞에 `B` (`B11010`)
    
    부호 없는 정수 → 뒤에 `u`, `U` (`123U`, `123u`)
    
    4바이트 정수 → 뒤에 `l`, `L` (`123L`, `123l`)
    
- 데이터형
    
    ⭐아두이노는 데이터형의 용량이 절반임 ⭐
    
    ex) `int` → 2Byte, `char` → 1Byte, `long` → 4Byte, `float` → 4Byte, `double` → 4Byte
    
    ⇒ `int`범위도 -32,768~32,768
    
- `const` 변수
    
    ex) `const int led = 13` 
    
    - 변숫값이 상수가 되어 컴파일할 때 무조건 상수로 치환됨
    - 프로그램의 크기를 줄일 수 있음
- `static`변수
    
    ```cpp
    void loop() {
      static int i = 0;
      Serial.println(i++);
      delay(1000);
    }
    ```
    
    - `i`가 처음 선언됐을 때만 초기화됨
    - `loop()` 를 반복해도 `i`의 값이 계속 증가
    - `static`키워드를 사용하여 초기화 하지 않았다면 계속해서 `0`만 출력함
- 문자열 처리 함수
    - `strcat` : 문자열 연결
    - `strchr`, `strstr`: 문자열에서 문자/문자열 검색
    - `strcmp`, `strncmp`: 문자열 비교
    - `strcpy`: 문자열 복사
    - `strlen`: 문자열 길이
- 시간 제어 함수
    - `millis()` : 아두이노가 켜졌을 때부터 흐른 시간을 반환(밀리초)
    - `micros()`: 아두이노가 켜졌을 떄부터 흐른 시간을 반환(마이크로초)
    - `delay(ms)`
    - `delayMicroseconds(us)`: 마이크로초 만큼 대기

## 아두이노 센서 기초

- 아날로그 센서(`analogRead`)
    
    : 볼륨, 가변저항, 광센서, 온도 센서, 적외선 거리 센서, 가속도 센서
    
- 디지털 센서(`pinMode`, `digitalRead`)
    
    : 스위치, 진동/기울기 센서, 자기장 센서, 인체 감지 센서, 적외선 리모컨 수신 모듈
    
- `pinMode` 에서 모드가 `INPUT`일 때는 생략 가능

### 풀업 저항

- 디지털 입력 시 HIGH와 LOW의 중간 값이 읽히면 오작동
- `INPUT`모드일 때 디지털 입력이더라도 `Serial.println(digitalRead(8))`에서 항상 0, 1만 출력하는 건 아님
    
    ⇒ 풀업 저항으로 중간값이 읽히는 현상을 방지
