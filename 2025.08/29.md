# 아두이노

모두의 아두이노(다카모토 다카요리/장진희) p.142~167

---

## 출력 부품

- LED, 스피커는 아날로그, 디지털 두 방법 모두 제어할 수 있음
- 출력 포트
    - 아날로그: D3, D5, D6, D9, D11의 PWM 포트(보드에서 `~`로 표시)
    - 디지털: D0~D13 + 시리얼 통신(UART, I2C, SPI)
- 아날로그 출력(PWM)
    - `analogWrite()` → 0~255의 입력값을 받아 출력
    - 실제로는 PWM을 사용하여 유사 아날로그 신호를 출력함
    - 아두이노의 PWM은 490Hz(1초에 490번 진동)로 전압을 제어
        
        ⇒ HIGH와 LOW의 진동에 의한 평균 전압이 출력값이 됨
        
    - `analogWrite(pin, 0);` → 0% (0V)
        
        `analogWrite(pin, 51);` → 20% (1V)
        
        `analogWrite(pin, 102);` → 40% (2V)
        
        `analogWrite(pin, 153);` → 60% (3V)
        
        `analogWrite(pin, 204);` → 80% (4V)
        
        `analogWrite(pin, 255);` → 100%(5V)
        
- 디지털 출력
    - 아날로그와 다르게 `pinMode()`로 반드시 모드 설정해야 함

### 아날로그 LED

- 490Hz 주파수로 전압을 변화 ⇒ 1/490초 단위로 HIGH ↔ LOW 전환됨
- 저항 값 계산
    
    ```cpp
    LED와 함께 사용할 저항값(Ω) = (전원 전압(V) - LED규격 전압(V)) / 정격 전류(A)
    ```
    
    - 저항 값이 반드시 딱 맞아떨어져야 하는 건 아님
- LED → 극성 부품이므로 양극(애노드. 다리가 긴 쪽), 음극(캐소드, 다리가 짧은 쪽)에 맞춰 잘 연결해야 함
- LED 밝기 변화
    
    ```cpp
    byte n = 5;
    for (int i = 0; i < n; i++) {
    	analogWrite(pin, 255 * i / n);
    	delay(1000);
    }
    ```
    
    `analogWrite`의 인자를 변화시키며 LED에 밝기 변화를 줄 수 있음 (이때 출력은 PWM)
    

### 아날로그 압전 스피커

- 압전 스피커 → 디지털, 아날로그 모두 제어할 수 있음
- 플러스와 마이너스로 계속해서 바뀌는 신호(AC)를 걸면 스피커의 막의 진동이 소리를 발생시키는 원리
- 아날로그의 경우 HIGH, LOW의 간격이 같을 때(50%) 진동이 발생하여 소리가 남
    - 소리의 높이는 아두이노의 PWM 제어 주파수인 490Hz로 고정 (아날로그에서 소리를 내는 경우의수가 한가지밖에 없음)
    
    ⇒ `analogWrite(pin, 255/2);`
    
- 극성 부품이 아니므로 PWM핀과 GND에 아무렇게나 연결해도 됨

<aside>
❓

플러스와 마이너스에 진동을 가해야 소리가 난다고 했으면서 어떻게 극성 부품이 아님?

⇒ (GPT) 압전 소자에 한쪽 방향으로만(DC) 전압을 걸면 그냥 휘어진 채로 멈춰 있음. 반대쪽 방향으로 전압을 걸면 반대쪽으로 휨. 이 성질을 이용하여 전압이 +와 -로 번갈아 바뀌는(AC) 신호를 걸면 압전 소자가 진동하며 소리가 발생함. 

압전 소자에 양극과 음극이 있다는 말이 아님

</aside>

### 디지털 LED

- LED를 아두이노에 직접 연결할 때는 저항이 필요없지만(5V, 100mA),
    
    빵판을 통해 건전지에 직접 연결할 때는 저항이 필요
    
- LED 밝기 변화
    - `digitalWrite()`와 `delay()` 를 번갈아 실행하면서 껐다 키는 간격을 조정하면 PWM과 비슷하게 밝기를 조절할 수 있음
    
    ```cpp
    void loop() {
    	digitalWrite(pin, HIGH);
    	delay(8);
    	digitalWrite(pin, LOW);
    	delay(2);
    }
    ```
    

### 디지털 압전 스피커

- 한 주기에서 HIGH와 LOW의 시간이 동일해야 소리가 발생하는 것은 동일
- 아날로그에서는 HIGH와 LOW의 비율만 조정할 수 있었지만, 디지털에서는 주기의 시간을 직접 조정할 수 있음
    
    ```cpp
    n = 2;
    digitalWrite(pin, HIGH);
    delay(n);
    digitalWrite(pin, LOW);
    delay(n);
    ```
    
    위의 코드에서 주기는 2ms * 2 = 4ms ⇒ 따라서 1초동안 진동 횟수인 주파수는 1000 / 4 = 250Hz
    
    ⇒ 주기(delay)를 설정함으로써 소리의 높낮이를 제어할 수 있음
    
- 주파수가 m인 소리를 내기 위해서는 1초 동안 HIGH-LOW 주기를 m번 반복하면 됨
    
    ⇒ HIGH와 LOW각각의 주기(delay; ms) = `1000 / hz / 2` 
    
- `tone(pin, frequency, duration);`
    - 위와 같이 delay시간을 직접 계산해서 `digitalWrite`해도 되지만 `tone`을 사용해도 됨
    - `pin`: 출력 핀
    - `frequency`: 출력할 주파수(음계)
    - `duration`: 출력할 시간(ms), 없어도 되는 매개변수
- `noTone(pin);`
    - 출력 핀의 신호 발생을 멈춤

### 아날로그 모터 (소형 DC팬)

- 대부분의 모터는 별도의 배터리를 필요로 하나
    
    소형 DC팬은 5V 50mA만으로도 움직이므로 아두이노만으로 가능
    
- 소형 DC팬 → 극성 부품
- 양극을 PWM, 음극을 GND에 연결 후 다음 코드로 동작
    
    ```cpp
    void loop() {
      for (int i = 0; i < 256; i+=5) {
        analogWrite(pin, 255 - i);  // PWM을 사용하는 아날로그 출력
        delay(100); 
      }
      delay(1000);
     }
    ```
    
    - 5V → 0V로 각 0.1초씩 약 5초간 회전 후 1초간 정지하는것 반복

### 가변저항으로 팬 제어

```cpp
void setup() {}
void loop() {
  int v = analogRead(A4);
  int converted_v = map(v, 0, 1023, 0, 255);
  analogWrite(D9, converted_v); // 디지털 포트는 D9처럼 쓰지 않음 
  delay(100);
 }

// 교재 코드
int v = analogRead(A4);
analogWrite(9, v / 1023.0 * 255); // float로 소수점을 보존해 주는 것에 유의
delay(100);
```

- 시스템 변숫값
    - `A0`  = 14
    - `A1` = 15
    - 디지털 입출력이 가능한 아날로그 핀은 `An`과 같이 사용가능
    - `A0`를 그냥 14로 써도 무방함
    - 디지털 입출력핀은 `D13`과 같이 사용 불가 ⇒ `13`으로 작성해야함
